# SCR103 動画視聴ページ 設計書

## 1. 画面概要

### 1.1 画面の目的

* 購入済みの講座動画を視聴させる。
* カリキュラム内で動画切替を可能とし、学習進捗が把握しやすい状態にする。

### 1.2 利用者ロール

| ロールID | ロール名 | 権限概要         |
| ----- | ---- | ------------ |
| R001  | 管理者  | 動作確認のため視聴可   |
| R002  | 受講者  | 購入済み講座の動画視聴可 |

### 1.3 関連機能・関連API

| 種別  | ID     | 名称                     | 用途             |
| --- | ------ | ---------------------- | -------------- |
| 機能  | F020   | 動画再生                   | 講座動画のストリーミング再生 |
| 機能  | F021   | カリキュラム内動画切替            | 別動画への切替        |
| 機能  | F022   | 視聴進捗の保存                | 再生位置・視聴済みフラグ保存 |
| API | API121 | get_playback_context   | 視聴対象動画・講座情報取得  |
| API | API122 | save_playback_progress | 視聴進捗保存         |

---

## 2. 画面レイアウト設計（UI仕様）

### 2.1 ワイヤーフレーム

* 最上部：共通ヘッダー（LAYOUT002 共通ヘッダー／フッター設計を参照）

* 上部：講座名・動画タイトル
* 左（または上部中央）：動画プレイヤー

  * 再生／一時停止
  * シークバー
  * 音量調整
  * 倍速切替
* 右（または下部）：カリキュラム一覧

  * 動画タイトル
  * 所要時間
  * 視聴済みアイコン
* 下部：操作

  * 「前の動画へ」「次の動画へ」
  * 「講座詳細へ戻る」

* 最下部：共通フッター（LAYOUT001 共通ヘッダー／フッター設計を参照）

### 2.2 UIコンポーネント一覧

※ 共通ヘッダー／フッターのUIコンポーネント定義は「LAYOUT001 共通ヘッダー／フッター設計」を参照し、本画面には記載しない。

| UI ID | コンポーネント種類       | ラベル      | 説明               |
| ----- | --------------- | -------- | ---------------- |
| UI41  | Text            | 講座タイトル   | 現在視聴中講座名         |
| UI42  | Text            | 動画タイトル   | 現在視聴中動画名         |
| UI43  | Video Player    | プレイヤー    | 再生画面             |
| UI44  | Dropdown/Select | 再生速度     | 1.0x/1.5x/2.0xなど |
| UI45  | List (repeat)   | カリキュラム一覧 | 動画リスト            |
| UI46  | Icon            | 視聴済みアイコン | 視聴済み状態表示         |
| UI47  | Button          | 前の動画へ    | 一つ前の動画へ移動        |
| UI48  | Button          | 次の動画へ    | 一つ後ろの動画へ移動       |
| UI49  | Button          | 講座詳細へ戻る  | SCR102へ戻る        |

---

## 3. 画面項目定義

### 3.1 入力項目一覧

| No | UI ID | 項目名  | 型      | 必須 | 桁数 | バリデーション | 備考              |
| -- | ----- | ---- | ------ | -- | -- | ------- | --------------- |
| 1  | UI44  | 再生速度 | string | 任意 | -  | 値の制限    | 1.0, 1.5, 2.0 等 |

### 3.2 表示項目一覧

| No | UI ID | 表示名    | DB項目                 | 型       | 備考         |
| -- | ----- | ------ | -------------------- | ------- | ---------- |
| 1  | UI41  | 講座タイトル | T_COURSE.course_name | string  |            |
| 2  | UI42  | 動画タイトル | T_VIDEO.title        | string  |            |
| 3  | UI45  | 動画タイトル | T_VIDEO.title        | string  | カリキュラム一覧側  |
| 4  | UI45  | 動画時間   | T_VIDEO.duration     | integer |            |
| 5  | UI46  | 視聴済み   | T_PLAYLOG.is_done    | boolean | true/false |

---

## 4. イベント処理定義

### 4.1 ボタン／イベント一覧

| イベントID | トリガー          | 説明           | 呼び出すAPI    | 遷移先 |
| ------ | ------------- | ------------ | ---------- | --- |
| EVT301 | 画面初期表示        | 視聴対象コンテキスト取得 | API121     | 画面内 |
| EVT302 | 再生位置一定間隔で変更   | 進捗保存         | API122     | 画面内 |
| EVT303 | カリキュラム選択クリック  | 動画切替         | API121（任意） | 画面内 |
| EVT304 | 「前の動画へ」「次の動画」 | 隣接動画への移動     | API121（任意） | 画面内 |

### 4.2 画面状態遷移

* 状態A：講座購入チェック
* 状態B：視聴許可（プレイヤー表示）
* 状態C：未購入（エラーメッセージ・購入導線表示）

---

## 5. エラー・メッセージ設計

### 5.1 入力エラー

該当なし。

### 5.2 業務エラー

| メッセージID | 内容                 | 発生条件       |
| ------- | ------------------ | ---------- |
| MSG301  | この動画を視聴する権限がありません。 | 未購入または権限不足 |
| MSG302  | 動画情報の取得に失敗しました。    | API121失敗   |
| MSG303  | 視聴進捗の保存に失敗しました。    | API122失敗   |

---

## 6. APIインターフェース仕様

### 6.1 リクエスト（API121: get_playback_context）

| パラメータ     | 型   | 必須 | 説明             |
| --------- | --- | -- | -------------- |
| course_id | int | 必須 | 講座ID           |
| video_id  | int | 任意 | 動画ID（省略時は前回続き） |

### 6.2 レスポンス（API121）

| フィールド             | 型       | 説明        |
| ----------------- | ------- | --------- |
| course_name       | string  | 講座名       |
| video_id          | int     | 現在動画ID    |
| video_title       | string  | 動画タイトル    |
| video_url         | string  | 再生用URL    |
| last_position_sec | integer | 最終再生位置（秒） |
| curriculum        | array   | カリキュラム一覧  |

### 6.3 リクエスト（API122: save_playback_progress）

| パラメータ        | 型       | 必須 | 説明      |
| ------------ | ------- | -- | ------- |
| course_id    | int     | 必須 | 講座ID    |
| video_id     | int     | 必須 | 動画ID    |
| position_sec | integer | 必須 | 現在位置（秒） |
| is_done      | boolean | 任意 | 視聴完了フラグ |

---

## 7. 権限・操作制御

| ロール   | 閲覧 | 登録 | 更新 | 削除 | 帳票出力 |
| ----- | -- | -- | -- | -- | ---- |
| 管理者   | ○  | ×  | ×  | ×  | ×    |
| 受講者   | ○  | ×  | ×  | ×  | ×    |
| 未ログイン | ×  | ×  | ×  | ×  | ×    |

---

## 8. 帳票設計

なし。

---

## 9. 対応DB

| テーブルID       | テーブル名    | 使用用途   |
| ------------ | -------- | ------ |
| T_COURSE     | 講座マスタ    | 講座名参照  |
| T_VIDEO      | 動画マスタ    | 動画情報参照 |
| T_PLAYLOG    | 視聴ログ     | 進捗保存   |
| T_ENROLLMENT | 受講権限テーブル | 購入チェック |

---

## 10. 非機能（画面観点）

| 項目     | 内容            |
| ------ | ------------- |
| 表示応答時間 | プレイヤー表示 3秒以内  |
| 再生開始時間 | 5秒以内（CDN利用前提） |

---

## 11. 前提・制約

* 動画再生はストリーミングのみ（ダウンロード不可）。
* 未購入ユーザーがURL直打ちした場合、講座詳細へリダイレクト＋メッセージ表示。

---
