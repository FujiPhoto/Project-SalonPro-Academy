# SCR104 マイページ画面 設計書

## 1. 画面概要

### 1.1 画面の目的

* ログインユーザーが自身の情報・購入済み講座・学習状況を一覧できる。
* 「どこから再開すればよいか」をわかりやすく提示する。

### 1.2 利用者ロール

| ロールID | ロール名 | 権限概要   |
| ----- | ---- | ------ |
| R001  | 管理者  | 動作確認可  |
| R002  | 受講者  | 自身情報参照 |

### 1.3 関連機能・関連API

| 種別  | ID     | 名称                 | 用途              |
| --- | ------ | ------------------ | --------------- |
| 機能  | F030   | マイページ表示            | ユーザー情報・講座一覧表示   |
| 機能  | F031   | 続きから視聴             | 最終視聴位置から動画再開    |
| API | API131 | get_mypage_summary | ユーザー概要・購入講座一覧取得 |

---

## 2. 画面レイアウト設計（UI仕様）

### 2.1 ワイヤーフレーム

* 最上部：共通ヘッダー（LAYOUT002 共通ヘッダー／フッター設計を参照）

* 上部：ユーザー情報エリア

  * 表示名
  * メールアドレス
* 中央：購入済み講座一覧（カードまたはリスト）

  * 講座タイトル
  * サムネイル
  * 進捗（例：3/10本視聴）
  * 最終視聴日時
  * 「続きから視聴」ボタン
  * 「詳細を見る」ボタン
* 下部：設定エリア（将来）

  * プロフィール編集へのリンク
  * ログアウトボタン（ヘッダー側でも可）

* 最下部：共通フッター（LAYOUT001 共通ヘッダー／フッター設計を参照）

### 2.2 UIコンポーネント一覧

※ 共通ヘッダー／フッターのUIコンポーネント定義は「LAYOUT001 共通ヘッダー／フッター設計」を参照し、本画面には記載しない。

| UI ID | コンポーネント種類     | ラベル      | 説明           |
| ----- | ------------- | -------- | ------------ |
| UI61  | Text          | 表示名      | ユーザー名        |
| UI62  | Text          | メールアドレス  | ユーザーID相当     |
| UI63  | Card (repeat) | 講座カード    | 購入済み講座一覧     |
| UI64  | Button        | 続きから視聴   | 動画視聴ページへ遷移   |
| UI65  | Button        | 詳細を見る    | 講座詳細画面へ遷移    |
| UI66  | Text          | 進捗表示     | 視聴済み数/総本数    |
| UI67  | Text          | 最終視聴日時   | 日時表示         |
| UI68  | Link          | プロフィール編集 | 別画面（将来）へのリンク |

---

## 3. 画面項目定義

### 3.1 入力項目一覧

マイページ自体で入力フォームは持たない（設定画面は別で定義）。

| No | UI ID | 項目名 | 型 | 必須 | 桁数 | バリデーション | 備考 |
| -- | ----- | --- | - | -- | -- | ------- | -- |
| -  | -     | -   | - | -  | -  | -       | -  |

### 3.2 表示項目一覧

| No | UI ID | 表示名     | DB項目                     | 型        | 備考        |
| -- | ----- | ------- | ------------------------ | -------- | --------- |
| 1  | UI61  | 表示名     | T_USER.display_name      | string   |           |
| 2  | UI62  | メールアドレス | T_USER.email             | string   |           |
| 3  | UI63  | 講座タイトル  | T_COURSE.course_name     | string   |           |
| 4  | UI63  | サムネイル   | T_COURSE.thumbnail_url   | string   |           |
| 5  | UI66  | 進捗      | 集計（視聴済み本数/総本数）           | string   | 表示用フォーマット |
| 6  | UI67  | 最終視聴日時  | T_PLAYLOG.last_viewed_at | datetime |           |

---

## 4. イベント処理定義

### 4.1 ボタン／イベント一覧

| イベントID | トリガー       | 説明            | 呼び出すAPI | 遷移先    |
| ------ | ---------- | ------------- | ------- | ------ |
| EVT401 | 画面初期表示     | ユーザー情報・講座一覧取得 | API131  | 画面内    |
| EVT402 | 「続きから視聴」押下 | 最終視聴位置の動画へ遷移  | なし      | SCR103 |
| EVT403 | 「詳細を見る」押下  | 講座詳細画面へ遷移     | なし      | SCR102 |

### 4.2 画面状態遷移

* 状態A：ログインチェック（未ログイン→ログイン画面へ）
* 状態B：購入講座あり
* 状態C：購入講座なし（「まだ講座を購入していません」メッセージ）

---

## 5. エラー・メッセージ設計

### 5.1 入力エラー

なし。

### 5.2 業務エラー

| メッセージID | 内容                 | 発生条件     |
| ------- | ------------------ | -------- |
| MSG401  | マイページ情報の取得に失敗しました。 | API131失敗 |
| MSG402  | 購入済み講座はまだありません。    | 講座一覧0件   |

---

## 6. APIインターフェース仕様

### 6.1 リクエスト（API131: get_mypage_summary）

| パラメータ   | 型   | 必須 | 説明         |
| ------- | --- | -- | ---------- |
| user_id | int | 必須 | ログインユーザーID |

### 6.2 レスポンス（サマリ）

| フィールド             | 型      | 説明      |
| ----------------- | ------ | ------- |
| display_name      | string | 表示名     |
| email             | string | メールアドレス |
| purchased_courses | array  | 購入講座リスト |

* purchased_courses要素例

| フィールド                       | 型        | 説明       |
| --------------------------- | -------- | -------- |
| course_id                   | int      | 講座ID     |
| course_name                 | string   | 講座名      |
| thumbnail_url               | string   | サムネイルURL |
| total_videos                | integer  | コース内総動画数 |
| completed_videos            | integer  | 視聴済み動画数  |
| last_viewed_course_video_id | int      | 最終視聴動画ID |
| last_viewed_at              | datetime | 最終視聴日時   |

---

## 7. 権限・操作制御

| ロール   | 閲覧 | 登録 | 更新 | 削除 | 帳票出力 |
| ----- | -- | -- | -- | -- | ---- |
| 管理者   | ○  | ×  | ×  | ×  | ×    |
| 受講者   | ○  | ×  | ×  | ×  | ×    |
| 未ログイン | ×  | ×  | ×  | ×  | ×    |

---

## 8. 帳票設計

なし。

---

## 9. 対応DB

| テーブルID       | テーブル名    | 使用用途      |
| ------------ | -------- | --------- |
| T_USER       | ユーザマスタ   | ログイン情報取得  |
| T_ENROLLMENT | 受講権限テーブル | 購入済み講座の判定 |
| T_COURSE     | 講座マスタ    | 講座情報取得    |
| T_PLAYLOG    | 視聴ログ     | 進捗・最終視聴日時 |

---

## 10. 非機能（画面観点）

| 項目     | 内容          |
| ------ | ----------- |
| 表示応答時間 | 2秒以内        |
| 最大講座件数 | 100件／ユーザー想定 |

---

## 11. 前提・制約

* ログイン必須画面。未ログインアクセス時はログイン画面へリダイレクト。
* プロフィール編集機能は別画面で定義予定。

---
