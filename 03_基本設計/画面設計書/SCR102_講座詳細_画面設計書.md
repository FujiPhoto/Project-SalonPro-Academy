# SCR102 講座詳細画面 設計書

## 1. 画面概要

### 1.1 画面の目的

* 受講者に当該講座の詳細情報（内容・対象・価格・カリキュラム）を提供し、購入意思決定をさせる。
* 購入ボタンから決済フローへ誘導する。

### 1.2 利用者ロール

| ロールID | ロール名  | 権限概要            |
| ----- | ----- | --------------- |
| R001  | 管理者   | 動作確認として閲覧可      |
| R002  | 受講者   | 閲覧・購入操作可        |
| R003  | 未ログイン | 閲覧可（購入時にログイン要求） |

### 1.3 関連機能・関連API

| 種別  | ID     | 名称                    | 用途                  |
| --- | ------ | --------------------- | ------------------- |
| 機能  | F010   | 講座詳細表示                | コース情報・講師情報・カリキュラム表示 |
| 機能  | F011   | 講座購入フロー開始             | 決済フロー開始             |
| API | API111 | get_course_detail     | 講座詳細情報取得            |
| API | API112 | get_course_curriculum | カリキュラム（動画一覧）取得      |
| API | API113 | create_order_draft    | 注文ドラフト作成（購入ボタン押下時）  |

---

## 2. 画面レイアウト設計（UI仕様）

### 2.1 ワイヤーフレーム（構造説明）

* 最上部：共通ヘッダー（LAYOUT002 共通ヘッダー／フッター設計を参照）

* 上部：パンくず（TOP ＞ カテゴリ名 ＞ 講座名）
* 左：講座情報

  * 講座タイトル
  * サブタイトル
  * レベル／カテゴリ
  * 概要テキスト
  * 学べること（箇条書き）
  * 対象者／前提スキル
* 右：購入ボックス

  * 価格
  * 視聴期限
  * 再生時間合計
  * 「購入する」ボタン
* 中央下：講師情報

  * 講師名
  * 顔写真
  * 経歴
* 下部：カリキュラム一覧（動画リスト）

  * 各動画タイトル
  * 所要時間
  * ステータス（無料プレビュー可など）

* 最下部：共通フッター（LAYOUT001 共通ヘッダー／フッター設計を参照）

### 2.2 UIコンポーネント一覧

※ 共通ヘッダー／フッターのUIコンポーネント定義は「LAYOUT001 共通ヘッダー／フッター設計」を参照し、本画面には記載しない。

| UI ID | コンポーネント種類           | ラベル      | 説明       |
| ----- | ------------------- | -------- | -------- |
| UI21  | Text                | 講座タイトル   | コース名     |
| UI22  | Text                | サブタイトル   | 任意の補足    |
| UI23  | Chip/Tag            | カテゴリ     | カテゴリ表示   |
| UI24  | Chip/Tag            | レベル      | 初級/中級/上級 |
| UI25  | Text                | 概要       | 講座説明文    |
| UI26  | List                | 学べること    | 箇条書きリスト  |
| UI27  | Text                | 対象者      | 想定受講者    |
| UI28  | Text                | 前提スキル    | 必要スキル    |
| UI29  | Text                | 価格       | 税込価格     |
| UI30  | Text                | 視聴期限     | 無期限/◯日など |
| UI31  | Text                | 総再生時間    | カリキュラム合計 |
| UI32  | Button              | 購入する     | 決済フロー開始  |
| UI33  | Text                | 講師名      |          |
| UI34  | Image               | 講師写真     |          |
| UI35  | Text                | 講師プロフィール | 経歴紹介     |
| UI36  | Table/List (repeat) | カリキュラム一覧 | 動画リスト    |
| UI37  | Button              | プレビュー再生  | 無料動画再生   |

---

## 3. 画面項目定義

### 3.1 入力項目一覧

入力は「購入する」ボタンのみ（パラメータは内部）とし、フォーム項目は無し。

| No | UI ID | 項目名  | 型   | 必須 | 桁数 | バリデーション | 備考             |
| -- | ----- | ---- | --- | -- | -- | ------- | -------------- |
| 1  | UI32  | 講座ID | int | 必須 | -  | 数値であること | URL/コンテキストから取得 |

### 3.2 表示項目一覧

| No | UI ID | 表示名    | DB項目                    | 型       | 備考       |
| -- | ----- | ------ | ----------------------- | ------- | -------- |
| 1  | UI21  | 講座タイトル | T_COURSE.course_name    | string  | 必須       |
| 2  | UI22  | サブタイトル | T_COURSE.subtitle       | string  | 任意       |
| 3  | UI23  | カテゴリ   | T_COURSE.category       | string  |          |
| 4  | UI24  | レベル    | T_COURSE.level          | string  |          |
| 5  | UI25  | 概要     | T_COURSE.description    | string  |          |
| 6  | UI26  | 学べること  | T_COURSE.learn_points   | json    | 箇条書きリスト  |
| 7  | UI27  | 対象者    | T_COURSE.target_users   | string  |          |
| 8  | UI28  | 前提スキル  | T_COURSE.prerequisites  | string  |          |
| 9  | UI29  | 価格     | T_PRODUCT.price         | integer | 税込       |
| 10 | UI30  | 視聴期限   | T_COURSE.expire_policy  | string  | 文言 or 日数 |
| 11 | UI31  | 総再生時間  | 集計値（動画合計）               | integer | 分数または秒数  |
| 12 | UI33  | 講師名    | T_INSTRUCTOR.name       | string  |          |
| 13 | UI34  | 講師写真   | T_INSTRUCTOR.photo_url  | string  | URL      |
| 14 | UI35  | プロフィール | T_INSTRUCTOR.profile    | string  |          |
| 15 | UI36  | 動画タイトル | T_VIDEO.title           | string  | 繰り返し     |
| 16 | UI36  | 動画時間   | T_VIDEO.duration        | integer | 分数または秒数  |
| 17 | UI36  | 無料フラグ  | T_VIDEO.is_free_preview | boolean | プレビュー可否  |

---

## 4. イベント処理定義

### 4.1 ボタン／イベント一覧

| イベントID | トリガー        | 説明            | 呼び出すAPI        | 遷移先          |
| ------ | ----------- | ------------- | -------------- | ------------ |
| EVT201 | 画面初期表示      | 講座詳細・カリキュラム取得 | API111, API112 | 画面内          |
| EVT202 | 「購入する」クリック  | 注文ドラフト作成      | API113         | 決済画面 or モーダル |
| EVT203 | プレビュー再生クリック | 無料動画再生        | （別API or 直URL） | プレイヤーモーダル    |

### 4.2 画面状態遷移

* 状態A：講座情報ロード中
* 状態B：講座情報表示
* 状態C：APIエラー時（エラーメッセージ表示）

---

## 5. エラー・メッセージ設計

### 5.1 入力エラー

該当なし。

### 5.2 業務エラー

| メッセージID | 内容                  | 発生条件          |
| ------- | ------------------- | ------------- |
| MSG201  | 講座情報の取得に失敗しました。     | API111失敗      |
| MSG202  | カリキュラム情報の取得に失敗しました。 | API112失敗      |
| MSG203  | 購入処理を開始できませんでした。    | API113失敗      |
| MSG204  | この講座は現在購入できません。     | 講座ステータス＝非公開など |

---

## 6. APIインターフェース仕様（画面→API）

### 6.1 リクエスト（API111: get_course_detail）

| パラメータ     | 型   | 必須 | 説明   |
| --------- | --- | -- | ---- |
| course_id | int | 必須 | 講座ID |

### 6.2 レスポンス（API111）

上記「表示項目」の対応フィールド。

### 6.3 リクエスト（API113: create_order_draft）

| パラメータ     | 型   | 必須 | 説明               |
| --------- | --- | -- | ---------------- |
| course_id | int | 必須 | 購入対象講座ID         |
| user_id   | int | 必須 | 要ログイン。未ログイン時は401 |

---

## 7. 権限・操作制御

| ロール   | 閲覧 | 登録 | 更新 | 削除 | 帳票出力 |
| ----- | -- | -- | -- | -- | ---- |
| 管理者   | ○  | ×  | ×  | ×  | ×    |
| 受講者   | ○  | ×  | ×  | ×  | ×    |
| 未ログイン | ○  | ×  | ×  | ×  | ×    |

※「購入する」はログイン必須。未ログイン時はログイン画面へ遷移。

---

## 8. 帳票設計

なし。

---

## 9. 対応DB

| テーブルID       | テーブル名  | 使用用途     | 備考 |
| ------------ | ------ | -------- | -- |
| T_COURSE     | 講座マスタ  | 講座情報参照   | 参照 |
| T_VIDEO      | 動画マスタ  | カリキュラム参照 | 参照 |
| T_INSTRUCTOR | 講師マスタ  | 講師情報参照   | 参照 |
| T_PRODUCT    | 商品マスタ  | 価格情報参照   | 参照 |
| T_ORDER      | 注文テーブル | 注文ドラフト作成 | 更新 |

---

## 10. 非機能（画面観点）

| 項目     | 内容              |
| ------ | --------------- |
| 表示応答時間 | 3秒以内（詳細＋カリキュラム） |
| 最大動画数  | 50本／講座          |

---

## 11. 前提・制約

* 講座が非公開の場合、URL直打ちでも404相当を返す。
* 購入フローは別画面（決済画面）で定義。

---
