# SCR203 注文・売上一覧画面 画面設計書

---

## 1. 画面概要

### 1.1 画面の目的

管理者が注文履歴および売上状況を一覧・検索し、個別の注文内容を確認できるようにする。

- 期間／講座／ユーザ等で絞り込んだ注文一覧の確認
- 個別注文のステータス・金額・対象講座の確認
- 日次・月次売上の概況把握（簡易サマリ／帳票連携のベース）

### 1.2 利用者ロール

| ロールID | ロール名   | 権限概要                   |
|----------|------------|----------------------------|
| R001     | 管理者     | 全件検索・帳票出力可       |
| R002     | 経理担当   | 検索・帳票出力のみ         |

### 1.3 関連機能・関連API

| 種別 | ID       | 名称                            | 用途                        |
|------|----------|---------------------------------|-----------------------------|
| 機能 | F401     | 注文一覧検索・表示             | 条件に応じた一覧表示        |
| 機能 | F402     | 注文詳細表示（簡易）           | テーブル内に詳細表示        |
| 機能 | F403     | 売上サマリ表示（期間合計）     | 画面上部に合計金額表示      |
| 機能 | F404     | CSV出力（任意）                | 注文データのエクスポート    |
| API  | API401   | search_orders                  | 注文検索                    |
| API  | API402   | export_orders_as_csv           | 注文CSV出力（任意）         |

---

## 2. 画面レイアウト設計（UI仕様）

### 2.1 ワイヤーフレーム（テキスト説明）

- 上部：検索条件エリア
  - 期間（開始日／終了日）
  - ユーザメール（部分一致）
  - 講座（ドロップダウン）
  - ステータス（成功／失敗／返金 等）
  - 検索ボタン／クリアボタン
- 上部右：簡易サマリ
  - 検索条件にマッチした注文数
  - 売上合計金額
- 中央：注文一覧テーブル
  - 注文ID
  - 注文日時
  - ユーザメール
  - 講座名
  - 金額
  - ステータス
- 下部右：CSV出力ボタン（任意）

### 2.2 UIコンポーネント一覧

| UI ID  | コンポーネント種類 | ラベル             | 説明                               |
|--------|---------------------|--------------------|------------------------------------|
| UI401  | DatePicker          | 開始日             | 検索期間（From）                   |
| UI402  | DatePicker          | 終了日             | 検索期間（To）                     |
| UI403  | TextBox             | ユーザメール       | 部分一致検索                       |
| UI404  | Dropdown            | 講座               | 講座マスタから選択                 |
| UI405  | Dropdown            | ステータス         | 成功／失敗／返金 等                |
| UI406  | Button              | 検索               | 検索実行                           |
| UI407  | Button              | クリア             | 条件リセット                       |
| UI408  | Label               | 件数サマリ         | 「◯件」表示                        |
| UI409  | Label               | 売上合計サマリ     | 「売上合計：¥◯◯◯◯」               |
| UI410  | Table               | 注文一覧           | 検索結果一覧                       |
| UI411  | Button              | CSV出力            | 検索結果のCSV出力（任意機能）      |

---

## 3. 画面項目定義（Field Definition）

### 3.1 入力項目一覧

| No | UI ID | 項目名     | 型      | 必須 | 桁数 | バリデーション                  | 備考           |
|----|-------|------------|---------|------|------|---------------------------------|----------------|
| 1  | UI401 | 開始日     | date    | 任意 | -    | 日付形式                         |                |
| 2  | UI402 | 終了日     | date    | 任意 | -    | 日付形式                         | 開始日≦終了日 |
| 3  | UI403 | ユーザメール | string | 任意 | 200  | 文字列                           | 部分一致       |
| 4  | UI404 | 講座       | int     | 任意 | -    | 講座ID（マスタ値）               ||
| 5  | UI405 | ステータス | string  | 任意 | 20   | 定義済みステータスコードのみ     ||

### 3.2 表示項目一覧（テーブル欄）

| No | UI ID | 表示名       | DB項目                | 型      | 備考                   |
|----|-------|--------------|-----------------------|---------|------------------------|
| 1  | UI410 | 注文ID       | T_ORDER.order_id      | int     |                        |
| 2  | UI410 | 注文日時     | T_ORDER.ordered_at    | datetime|                        |
| 3  | UI410 | ユーザメール | T_USER.email          | string  | JOIN                    |
| 4  | UI410 | 講座名       | T_COURSE.course_name  | string  | JOIN                    |
| 5  | UI410 | 金額         | T_ORDER.amount        | integer |                        |
| 6  | UI410 | ステータス   | T_ORDER.status        | string  | 成功／失敗／返金 等     |

---

## 4. イベント処理定義（Event & Transition）

### 4.1 ボタン／イベント一覧

| イベントID | トリガー          | 説明                           | 呼び出すAPI | 遷移先  |
|------------|-------------------|--------------------------------|-------------|---------|
| EVT401     | 検索ボタン押下   | 検索条件に基づき注文一覧取得   | API401      | 画面内  |
| EVT402     | クリアボタン押下 | 検索条件クリア＋再検索         | API401      | 画面内  |
| EVT403     | CSV出力押下      | 検索条件に基づきCSV出力        | API402      | ダウンロード |

### 4.2 画面状態遷移

- 状態A：初期表示（デフォルト期間で検索済み）
- 状態B：検索条件変更後の表示
- 状態C：検索結果0件表示
- 状態D：APIエラー表示

---

## 5. エラー・メッセージ設計

### 5.1 入力エラー

| メッセージID | 内容                                      | 表示タイミング                            |
|--------------|-------------------------------------------|-------------------------------------------|
| MSG401       | 開始日と終了日の関係が不正です。          | 開始日 > 終了日の場合                     |

### 5.2 業務エラー

| メッセージID | 内容                          | 発生条件                  |
|--------------|-------------------------------|---------------------------|
| MSG402       | 注文データが存在しません。    | 検索結果0件              |
| MSG403       | 注文データの取得に失敗しました。| API401失敗               |
| MSG404       | CSV出力に失敗しました。       | API402失敗               |

---

## 6. APIインターフェース仕様（画面→API）

### 6.1 リクエスト（API401: search_orders）

| パラメータ | 型      | 必須 | 説明                 |
|------------|---------|------|----------------------|
| date_from  | date    | 任意 | 開始日               |
| date_to    | date    | 任意 | 終了日               |
| email      | string  | 任意 | ユーザメール（部分） |
| course_id  | int     | 任意 | 講座ID               |
| status     | string  | 任意 | ステータス           |
| page       | integer | 任意 | ページ番号           |
| page_size  | integer | 任意 | 1ページあたり件数    |

### 6.2 レスポンス（API401）

| フィールド      | 型      | 説明                         |
|-----------------|---------|------------------------------|
| total_count     | integer | 検索条件にヒットした総件数   |
| total_amount    | integer | 検索条件にヒットした売上合計 |
| items           | array   | 注文一覧（3.2 に準拠）       |

### 6.3 リクエスト（API402: export_orders_as_csv）

- パラメータは API401 と同一（検索条件に基づきCSVを出力）。

---

## 7. 権限・操作制御（RBAC）

### 7.1 操作権限表

| ロール   | 閲覧 | 登録 | 更新 | 削除 | 帳票出力（CSV） |
|----------|------|------|------|------|-----------------|
| 管理者   | ○    | ×    | ×    | ×    | ○               |
| 経理担当 | ○    | ×    | ×    | ×    | ○               |

---

## 8. 帳票設計（Report Design）

※ 必要に応じて CSV 出力を「帳票」とみなす。

### 8.1 対応帳票一覧

| 帳票ID | 帳票名       | 出力形式 | 出力トリガー | 備考                     |
|--------|--------------|----------|--------------|--------------------------|
| RPT401 | 注文一覧CSV | CSV      | CSV出力ボタン | 会計連携・分析用         |

### 8.2 帳票仕様（RPT401）

#### 8.2.1 用途

- 売上管理／会計連携のため、注文データを外部システムで集計／分析できるようにする。

#### 8.2.2 出力条件

- 画面SCR203の検索条件をそのまま利用し、結果をすべてCSV出力。

#### 8.2.3 出力レイアウト（カラム）

| 項目名       | 型      | 備考                        |
|--------------|---------|-----------------------------|
| order_id     | int     | 注文ID                      |
| ordered_at   | datetime| 注文日時                    |
| user_email   | string  | ユーザメール                |
| course_name  | string  | 講座名                      |
| amount       | int     | 金額                        |
| status       | string  | ステータス                  |

---

## 9. 対応DB（参照／更新）

| テーブルID | テーブル名   | 使用用途       | 備考 |
|-----------|--------------|----------------|------|
| T_ORDER   | 注文テーブル | 検索・集計     | 参照 |
| T_USER    | ユーザマスタ | メール参照     | 参照 |
| T_COURSE  | 講座マスタ   | 講座名参照     | 参照 |

---

## 10. 非機能（画面観点）

| 項目           | 内容                              |
|----------------|-----------------------------------|
| 表示応答時間   | 検索結果表示 5秒以内（ページング）|
| 最大表示件数   | 1ページあたり 100件を目安        |

---

## 11. 前提・制約

- 大量データを想定するため、必ずページングを行う。
- CSV出力はタイムアウト対策のため、件数上限を設定する（例：5万件まで）。

---
